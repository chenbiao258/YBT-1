<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper
	namespace="com.sinosoft.service.business.db.dao.BankInstitutionSelectAddDao">


	<resultMap
		type="com.sinosoft.service.business.ui.bankInstitutionManage.bean.BankInstitutionManageSelectBean"
		id="BaseResultMap">
		<result column="comcode" jdbcType="VARCHAR" property="bankCode" />
		<result column="COMNAME" jdbcType="VARCHAR" property="bankName" />
		<result column="SatrapName" jdbcType="VARCHAR" property="satrapName" />
		<result column="bankstatus" jdbcType="VARCHAR" property="bankStatus" />
		<result column="enddate" jdbcType="VARCHAR" property="endDate" />
		<result column="makedate" jdbcType="VARCHAR" property="makeDate" />
	</resultMap>

	
   <select id="selectByComcode" resultMap="BaseResultMap">
	</select>

	<!-- 查询全部银行机构 -->
	<select id="selectAllBankInstitution" resultMap="BaseResultMap">

		select a.comcode
		as bankCode,
		a.COMNAME,
		a.SatrapName,
		(select b.codename
		from ldcode b
		where b.codetype = 'sign'
		and trim(b.code) = a.validflag) as bankstatus,
		a.enddate,
		a.makedate
		from
		ldcom a
		order by a.comcode

	</select>
	
	<!-- 银行机构表单明细查询 -->
	<select id="selectDetail" parameterType="String"
		resultType="com.sinosoft.service.business.ui.bankInstitutionManage.bean.SaveInputBean">
		select
		 t.comname as bankName,
		 t.comcode as bankCode,
		 decode(t.bankPlace,'E','东区','S','南区','N','北区','') as bankPlace,
		 (select trim(c.CodeName)
		    from ldcode c
		   where trim(c.Code) = trim(t.Fax)
		     and codetype = 'checkbank') as checkStatus,
 
		 (select trim(c.CodeName)
		    from ldcode c
		   where trim(c.Code) = trim(t.validflag)
		     and codetype = 'sign') as bankStatus,
		 t.operator as operator,
		 (select cityname from areaCodeFull where citycode=t.Address) as bankCity
 		 from ldcom t where t.comCode = #{bankCode}
	</select>
	
	<!--查询银行机构资格证明细  -->
	<select id="selectTableDetail" parameterType="String"
		resultType="com.sinosoft.service.business.ui.bankInstitutionManage.bean.TableBean">
		select 
		   a.comtype as type,
	       a.comDealNo comDealNo,
	       a.approval as approve,
	       a.makeDate as makedate,
	       a.startDate as startdate,
	       a.endDate as enddate,
	       a.repalceDate as replacedate,
	       a.status as bankStatus,
	       a.comdealinfono as typeName,
	       a.agentCom as bankCode,
	       a.id as id
 		 from ldcomdealinfo a
 		where a.agentCom = #{bankCode}
	
	</select>

	<!-- 根据银行代号查询 -->
	<select id="selectBankInstitutionByBankCode" parameterType="String"
		resultMap="BaseResultMap">
		select a.comcode as bankCode,
		a.comname,
		a.SatrapName,
		(select b.codename
		from ldcode b
		where b.codetype = 'sign'
		and trim(b.code) = a.validflag) as bankstatus,
		a.enddate,
		a.makedate
		from
		ldcom a
		
		where a.comcode = #{bankCode}
	</select>

	
	<!-- 查询城市 -->
	<select id="selectCity"
		resultType="com.sinosoft.service.business.ui.bankInstitutionManage.bean.ProvinceCityBean"
		parameterType="String">
		select
		CITYNAME, CITYCODE
		from
		areaCodeFull
	</select>


	<!-- 查询type -->
	<select id="selectType"
		resultType="com.sinosoft.service.business.ui.bankInstitutionManage.bean.ProvinceCityBean">
		select
		Code as cityCode,
		CodeName as cityName
		from
		ldcode
		where
		codetype = 'qualiname'
		order by Code
	</select>

	<select id="selectExit" 
		resultType="Integer">
		select count(*) from 
		
		(select comcode from ldcom where comname=#{input.bankName} or comcode =#{input.bankCode}
		UNION ALL
		select comcode from ldcomA where comname=#{input.bankName} or comcode =#{input.bankCode}
		
		)
	</select>

	<!-- 银行机构保存 -->
	<!-- 1.将页面输入部分的数据插入 -->
	<insert id="insertLDComA"
		parameterType="com.sinosoft.service.business.ui.bankInstitutionManage.bean.SaveInputBean">
		insert into LDComA
			(ComCode,comName,
			Address,ZipCode,Phone,
			Fax,SatrapName,
			ComCitySize,ComGrade,
			UpComCode,ValidFlag,Operator,
			MakeDate,MakeTime,ModifyDate,ModifyTime,bankPlace)
		values
			(#{bankCode,jdbcType=VARCHAR},#{bankName,jdbcType=VARCHAR},
			 #{bankCity,jdbcType=VARCHAR},'','',
			 'W','Y',
			 '','',
			 '',#{bankStatus,jdbcType=VARCHAR},#{operator,jdbcType=VARCHAR},
			 #{makedate,jdbcType=DATE},#{maketime,jdbcType=VARCHAR},#{modifydate,jdbcType=DATE},#{modifytime,jdbcType=VARCHAR},
			 #{bankPlace,jdbcType=VARCHAR})
			 
	</insert>
	<!-- 2.将table的数据插入 -->
	<insert id="insertLDComDealInfoA"
		parameterType="com.sinosoft.service.business.ui.bankInstitutionManage.bean.TableBean">
		
			insert into LDComDealInfoA
  				(ComDealInfoNo,AgentCom,ComType,
  				 ComDealNo,MakeDate,StartDate,
  				 EndDate,RepalceDate,Status,Approval,id)
			values
			(#{typeName,jdbcType=VARCHAR},#{bankCode,jdbcType=VARCHAR},#{type,jdbcType=VARCHAR},
			 #{approve,jdbcType=VARCHAR},#{makedate,jdbcType=DATE},#{startdate,jdbcType=DATE},
			 #{enddate,jdbcType=DATE},#{replacedate,jdbcType=DATE},'Y',#{grant,jdbcType=VARCHAR},BANKID_SEQ.Nextval)
	</insert>


</mapper>