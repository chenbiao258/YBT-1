<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.sinosoft.service.business.db.dao.LatrainingDao">
	<resultMap id="BaseResultMap" type="com.sinosoft.service.business.db.vo.LatrainingVo">
    <id column="staffid" jdbcType="VARCHAR" property="staffid" />
    <result column="id" jdbcType="VARCHAR" property="id" />
    <result column="name" jdbcType="VARCHAR" property="name" />
    <result column="preferredFirstName" jdbcType="VARCHAR" property="preferredFirstName" />
    <result column="courseCode" jdbcType="TIMESTAMP" property="courseCode" />
    <result column="courseTitle" jdbcType="VARCHAR" property="courseTitle" />
    <result column="insuranceType" jdbcType="TIMESTAMP" property="insuranceType" />
    <result column="trainingtype" jdbcType="VARCHAR" property="trainingtype" />
    <result column="trainingno" jdbcType="VARCHAR" property="trainingno" />
    <result column="rate" jdbcType="TIMESTAMP" property="rate" />
    <result column="hour" jdbcType="VARCHAR" property="hour" />
    <result column="startdate" jdbcType="TIMESTAMP" property="startdate" />
    <result column="enddate" jdbcType="TIMESTAMP" property="enddate" />
    <result column="status" jdbcType="VARCHAR" property="status" />
     <result column="makedate" jdbcType="TIMESTAMP" property="makedate" />
    <result column="maketime" jdbcType="VARCHAR" property="maketime" />
    <result column="modifydate" jdbcType="TIMESTAMP" property="modifydate" />
    <result column="modifytime" jdbcType="VARCHAR" property="modifytime" />
   
  </resultMap>
  <sql id="Base_Column_List">
    id,staffid,name,courseCode,courseTitle,insuranceType,preferredFirstName,trainingtype,trainingno,rate,hour,startdate,enddate,status,makedate,maketime,modifydate,modifytime
  </sql>
  
  <select id="selectByQualifitype" parameterType="com.sinosoft.service.business.db.vo.LatrainingVo" resultMap="BaseResultMap">
  	select
		<include refid="Base_Column_List" /> 
		from latraining
		where qualifitype = #{qualifitype} 
  </select>
    <select id="selectBystaffid" parameterType="com.sinosoft.service.business.db.vo.LatrainingVo" resultMap="BaseResultMap">
  	select
		<include refid="Base_Column_List" /> 
		from latraining
		where staffid = #{staffid} 
  </select>
  
     <select id="selectAllstaffid" resultMap="BaseResultMap">
  	select
		distinct(staffid) 
		from latraining
  </select>
  
   <select id="download" parameterType="String" resultMap="BaseResultMap">
  	select
		<include refid="Base_Column_List" /> 
		from latraining
		where staffid=#{staffid}<!-- in <foreach item="AList" index="index" collection="list"
                open="(" separator="," close=")"> #{AList}</foreach> -->

  </select>
  <select id="downloadall" resultType="com.sinosoft.service.business.ui.latraining.bean.aptitudeAllBean">

   
   select l.*,
          s.*,
          (select j.salesrole1 from jobcode j where j.jobcode = l.jobcode) as salesrole1,
          (select j.salesrole2 from jobcode j where j.jobcode = l.jobcode) as salesrole2,
          (select r.region from regionall r where r.department = l.department) as region,
          (select r.city from regionall r where r.department = l.department) as city,
          (select r.subbranch from regionall r where r.department = l.department) as subbranch,
          (select distinct(a.preferredfirstname) from latraining a where a.staffid = l.emplid and a.name =l.name and a.preferredfirstname is not null and rownum=1) as preferredfirstname
     from lduser l
     left join laqualidetails s on l.emplid = s.staffid
     union
   select l.*,
          s.*,
          (select j.salesrole1 from jobcode j where j.jobcode = l.jobcode) as salesrole1,
          (select j.salesrole2 from jobcode j where j.jobcode = l.jobcode) as salesrole2,
          (select r.region from regionall r where r.department = l.department) as region,
          (select r.city from regionall r where r.department = l.department) as city,
          (select r.subbranch from regionall r where r.department = l.department) as subbranch,
          (select distinct(a.preferredfirstname) from latraining a where a.staffid = l.emplid and a.name =l.name and a.preferredfirstname is not null and rownum=1) as preferredfirstname
     from lduser l
     left join externalgifts s on l.emplid = s.staffid


  </select>
  
     <select id="countdownload"  resultType="Integer">
  	select
		count(distinct(staffid))
		from latraining
		<!-- where id in <foreach item="AList" index="index" collection="list"
                open="(" separator="," close=")"> #{AList}</foreach>
 -->
  </select>
  <select id="selectAll"  resultMap="BaseResultMap">
       select distinct(staffid) from  latraining
  </select>
  
   <select id="selectBytypeAndinfoAll" parameterType="com.sinosoft.service.business.db.vo.LatrainingVo" resultMap="BaseResultMap">
        select <include refid="Base_Column_List" />  from laqualiinfo where qualifitype=#{qualifitype} and qualiinfo=#{qualiinfo}
  </select>
  
  
  <delete id="deleteBytypeAndinfo" parameterType="com.sinosoft.service.business.db.vo.LatrainingVo">
   delete from  latraining 
   where 1=1
    <if test="staffid != null">
      and  staffid= #{staffid,jdbcType=VARCHAR}
      </if>
      <if test="courseCode != null">
      and  courseCode = #{courseCode,jdbcType=VARCHAR}
      </if>
      <if test="courseTitle != null">
      and  courseTitle= #{courseTitle,jdbcType=TIMESTAMP}
      </if>
      <if test="id != null">
      and   id = #{id} 
      </if>
     
  </delete>
  
  <select id="select" resultMap="BaseResultMap">
  	select * from t_sys_user
  </select>
  
  <select id="queryByUserCode" parameterType="com.sinosoft.service.business.db.vo.LatrainingVo" resultMap="BaseResultMap">
		select
		<include refid="Base_Column_List" /> 
		from t_sys_user
		where "user_code" = #{userCode} 
	   		 
	</select>
	
	<select id="queryByUserCodeAndName" parameterType="com.sinosoft.service.business.db.vo.LatrainingVo" resultMap="BaseResultMap">
		select
		<include refid="Base_Column_List" /> 
		from t_sys_user
		where "user_code" = #{userCode} and "user_name" = #{userName}
	    
	</select>

<select id="selectldtraining" parameterType="java.lang.String" resultType="com.sinosoft.service.business.db.vo.ldtrainingVo">
select * from ldtraining where courseCode=#{courseCode}
</select>

<insert id="insertjob" parameterType="com.sinosoft.service.business.ui.latraining.bean.JobCodeBean">
   insert into jobcode
  (jobcode,courseTitle)
    values (#{jobcode,jdbcType=VARCHAR},
    #{salesrole1,jdbcType=VARCHAR},#{salesrole2,jdbcType=VARCHAR})
  </insert>

<insert id="insertCoursecode" parameterType="com.sinosoft.service.business.db.vo.LatrainingVo">
   insert into ldtraining
  (courseCode,courseTitle)
    values (#{courseCode,jdbcType=VARCHAR},
    #{courseTitle,jdbcType=VARCHAR})
  </insert>

  	<insert id="insert" parameterType="com.sinosoft.service.business.db.vo.LatrainingVo">
   insert into latraining
  (id,staffid,name,courseCode,courseTitle,insuranceType,preferredFirstName, trainingtype,trainingno, rate,hour,startdate,enddate,status, makedate,maketime,modifydate,modifytime)
    values (seq_latraining.nextval,#{staffid,jdbcType=VARCHAR},
    #{name,jdbcType=VARCHAR}, #{courseCode,jdbcType=VARCHAR},
    #{courseTitle,jdbcType=VARCHAR}, #{insuranceType,jdbcType=VARCHAR},
    #{preferredFirstName,jdbcType=VARCHAR}, #{trainingtype,jdbcType=VARCHAR},
     #{trainingno,jdbcType=VARCHAR},#{rate,jdbcType=VARCHAR},
     #{hour,jdbcType=VARCHAR}, #{startdate,jdbcType=TIMESTAMP},#{enddate,jdbcType=TIMESTAMP},#{status,jdbcType=VARCHAR},#{makedate,jdbcType=TIMESTAMP}, #{maketime,jdbcType=VARCHAR},#{modifydate,jdbcType=TIMESTAMP}, #{modifytime,jdbcType=VARCHAR})
  </insert>
	 

	 
	 
	<update id="updateLaqualiinfoByQualifitype" parameterType="com.sinosoft.service.business.db.vo.LatrainingVo">
    update laqualiinfo
    <set>
      <if test="qualiinfo != null">
        qualiinfo= #{qualiinfo,jdbcType=VARCHAR},
      </if>
       <if test="flag != null">
        flag = #{flag,jdbcType=VARCHAR},
      </if>
      <if test="modifydate != null">
        modifydate= #{modifydate,jdbcType=TIMESTAMP},
      </if>
      <if test="modifytime != null">
        modifytime= #{modifytime,jdbcType=VARCHAR},
      </if>
     </set>
    where qualifitype=#{qualifitype,jdbcType=VARCHAR} and qualiinfo=#{qualiinfo,jdbcType=VARCHAR}

  </update>	 
	 
</mapper>